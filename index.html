<!DOCTYPE html>
<!-- inline generator enabled: last update 2025-09-24 -->
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä HTML-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π</title>
  <meta name="description" content="–£–¥–æ–±–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è HTML-—Å—Ç—Ä–∞–Ω–∏—Ü     </div>
  </div>

  <!-- Fullscreen modal -->
  <div class="modal" id="fullscreenModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ø—Ä–µ–≤—å—é</h3>
        <button class="modal-close" id="modalClose">&times;</button>
      </div>
      <iframe class="modal-iframe" id="fullscreenIframe" title="–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ø—Ä–µ–≤—å—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏"></iframe>
    </div>
  </div>

  <!-- –®–∞–±–ª–æ–Ω —Å—Ç–∏–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤—Å—Ç—Ä–∞–∏–≤–∞—Ç—å—Å—è –≤ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π HTML -->—à–∞–≥–æ–≤—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏. –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π —Ñ–∞–π–ª: –≤—Å—ë –≤ index.html." />

  <style>
    :root {
      --bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --bg-pattern: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.15) 1px, transparent 0);
      --panel: rgba(255, 255, 255, 0.95);
      --panel-hover: rgba(255, 255, 255, 0.98);
      --text: #1a202c;
      --muted: #718096;
      --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --primary-hover: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
      --border: rgba(226, 232, 240, 0.8);
      --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      --code-bg: #2d3748;
      --code-fg: #e2e8f0;
    }
    [data-theme="dark"] {
      --bg: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
      --bg-pattern: radial-gradient(circle at 1px 1px, rgba(148, 163, 184, 0.1) 1px, transparent 0);
      --panel: rgba(30, 41, 59, 0.95);
      --panel-hover: rgba(30, 41, 59, 0.98);
      --text: #f1f5f9;
      --muted: #94a3b8;
      --primary: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
      --primary-hover: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);
      --border: rgba(51, 65, 85, 0.8);
      --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
      --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.6);
      --code-bg: #0f172a;
      --code-fg: #e2e8f0;
    }

    html, body { height: 100%; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Noto Sans', 'Helvetica Neue', Arial, 'Apple Color Emoji', 'Segoe UI Emoji';
      background: var(--bg), var(--bg-pattern);
      background-size: 100% 100%, 20px 20px;
      color: var(--text);
      min-height: 100vh;
      animation: backgroundShift 20s ease-in-out infinite;
    }
    @keyframes backgroundShift {
      0%, 100% { background-position: 0% 50%, 0 0; }
      50% { background-position: 100% 50%, 10px 10px; }
    }
    .wrap { max-width: 1200px; margin: 0 auto; padding: 24px; }
    header { display:flex; gap:16px; align-items:center; justify-content:space-between; margin-bottom:16px; }
    header h1 { font-size: clamp(20px, 3vw, 28px); margin: 0; }
    header .actions { display:flex; gap:8px; align-items:center; }

    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }

    .card { 
      background: var(--panel); 
      border: 1px solid var(--border); 
      border-radius: 16px; 
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
      position: relative;
    }
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
    }
    .card:hover { 
      transform: translateY(-2px); 
      box-shadow: var(--shadow-lg);
      background: var(--panel-hover);
    }
    .card h2 { 
      margin: 0; 
      padding: 20px 20px 0; 
      font-size: 18px; 
      font-weight: 600;
      background: linear-gradient(135deg, var(--text), var(--muted));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .card .body { padding: 20px; }

    label { display:block; font-size: 13px; color: var(--muted); margin-bottom: 6px; }
    input[type="text"], textarea, select {
      width: 100%; padding: 12px 16px; background: rgba(255,255,255,0.8); color: var(--text);
      border: 2px solid var(--border); border-radius: 12px; outline: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(5px);
    }
    input[type="text"]:focus, textarea:focus, select:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
      background: rgba(255,255,255,0.95);
    }
    [data-theme="dark"] input[type="text"], 
    [data-theme="dark"] textarea, 
    [data-theme="dark"] select {
      background: rgba(30, 41, 59, 0.8);
    }
    [data-theme="dark"] input[type="text"]:focus, 
    [data-theme="dark"] textarea:focus, 
    [data-theme="dark"] select:focus {
      background: rgba(30, 41, 59, 0.95);
    }
    textarea { resize: vertical; min-height: 68px; }

    .row { display:flex; gap:12px; align-items:center; }
    .row > * { flex: 1 1 auto; }
    .row .shrink { flex: 0 0 auto; }

    .btn {
      display:inline-flex; align-items:center; gap:8px; justify-content:center;
      padding: 12px 18px; border-radius: 12px; border: 1px solid var(--border);
      background: var(--panel); color: var(--text); cursor:pointer; user-select:none;
      font-weight: 500; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative; overflow: hidden;
    }
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    .btn:hover::before { left: 100%; }
    .btn:hover { transform: translateY(-1px); box-shadow: var(--shadow); }
    .btn:active { transform: translateY(0); }
    .btn.primary { 
      background: var(--primary); 
      color: white; 
      border-color: transparent;
      box-shadow: 0 4px 14px 0 rgba(102, 126, 234, 0.4);
    }
    .btn.primary:hover { 
      background: var(--primary-hover);
      box-shadow: 0 6px 20px 0 rgba(102, 126, 234, 0.6);
    }
    .btn.ghost { background: transparent; }
    .btn.ghost:hover { 
      background: rgba(102, 126, 234, 0.1);
      border-color: rgba(102, 126, 234, 0.3);
    }
    .btn.icon { width: 40px; height: 40px; padding: 0; border-radius: 10px; }

    .steps { display:flex; flex-direction:column; gap:16px; }
    .step { 
      padding: 16px; 
      border: 2px dashed rgba(102, 126, 234, 0.3); 
      border-radius: 12px; 
      background: rgba(255,255,255,0.5);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      animation: stepFadeIn 0.5s ease-out;
      backdrop-filter: blur(5px);
    }
    @keyframes stepFadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .step:hover {
      border-color: rgba(102, 126, 234, 0.6);
      background: rgba(255,255,255,0.8);
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }
    [data-theme="dark"] .step {
      background: rgba(30, 41, 59, 0.5);
      border-color: rgba(59, 130, 246, 0.3);
    }
    [data-theme="dark"] .step:hover {
      background: rgba(30, 41, 59, 0.8);
      border-color: rgba(59, 130, 246, 0.6);
    }
    .step-head { display:flex; gap:8px; align-items:center; margin-bottom:8px; }
    .step-index { 
      font-weight: 600; 
      color: var(--primary); 
      width:32px; 
      height:32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(102, 126, 234, 0.1);
      border-radius: 50%;
      font-size: 14px;
    }
    .step-controls { margin-left:auto; display:flex; gap:6px; }
    .step-drag-handle {
      cursor: grab;
      padding: 4px;
      border-radius: 6px;
      color: var(--muted);
      transition: all 0.2s;
      display: flex;
      align-items: center;
    }
    .step-drag-handle:hover {
      background: rgba(102, 126, 234, 0.1);
      color: var(--primary);
    }
    .step-drag-handle:active {
      cursor: grabbing;
    }
    .step.dragging {
      opacity: 0.5;
      transform: rotate(5deg);
      z-index: 1000;
      box-shadow: var(--shadow-lg);
    }
    .step.drag-over {
      border-color: #667eea;
      background: rgba(102, 126, 234, 0.1);
      transform: scale(1.02);
    }
    .steps.drag-active .step:not(.dragging) {
      transition: transform 0.2s ease;
    }

    .preview iframe { width:100%; height:520px; border:none; background:white; border-radius:8px; }

    .muted { color: var(--muted); font-size: 12px; }
    .sep { height:1px; background: var(--border); margin: 8px 0 16px; }

    /* Fullscreen modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 10000;
      backdrop-filter: blur(5px);
    }
    .modal.show {
      display: flex;
      align-items: center;
      justify-content: center;
      animation: modalFadeIn 0.3s ease-out;
    }
    @keyframes modalFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .modal-content {
      width: 95vw;
      height: 95vh;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
      box-shadow: var(--shadow-lg);
    }
    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: var(--panel);
      border-bottom: 1px solid var(--border);
    }
    .modal-header h3 {
      margin: 0;
      font-size: 16px;
      color: var(--text);
    }
    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--muted);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
    }
    .modal-close:hover {
      background: rgba(0, 0, 0, 0.1);
      color: var(--text);
    }
    .modal-iframe {
      width: 100%;
      height: calc(100% - 60px);
      border: none;
    }

    /* Styles embedded into generated HTML */
    .gen-style { display:none; }
  </style>
</head>
<body>
  <div class="wrap" id="app" data-theme="light">
    <header>
      <h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä HTML-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π</h1>
      <div class="actions">
        <label class="row shrink" style="gap:6px; align-items:center;">
          <span class="muted">–¢–µ–º–∞</span>
          <select id="theme">
            <option value="light">–°–≤–µ—Ç–ª–∞—è</option>
            <option value="dark">–¢—ë–º–Ω–∞—è</option>
          </select>
        </label>
        <button class="btn ghost" id="resetBtn" title="–û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É">–°–±—Ä–æ—Å</button>
      </div>
    </header>

    <div class="grid">
      <section class="card">
        <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —à–∞–≥–∏</h2>
        <div class="body">
          <div class="row">
            <div style="flex:1 1 70%">
              <label for="title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
              <input id="title" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–∞–∫ –∑–∞–≤–∞—Ä–∏—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–π –∫–æ—Ñ–µ" />
            </div>
            <div>
              <label for="listType">–¢–∏–ø —Å–ø–∏—Å–∫–∞</label>
              <select id="listType">
                <option value="ol">–ù—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π</option>
                <option value="ul">–ú–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π</option>
              </select>
            </div>
          </div>

          <div style="margin-top:12px;">
            <label for="intro">–û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
            <textarea id="intro" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏..."></textarea>
          </div>

          <div class="sep"></div>

          <div class="row" style="justify-content:space-between;">
            <h3 style="margin:0;font-size:16px;">–®–∞–≥–∏</h3>
            <div class="row shrink">
              <button class="btn ghost" id="addStep">+ –®–∞–≥</button>
              <button class="btn ghost" id="addStepFromLines">–ò–º–ø–æ—Ä—Ç –∏–∑ —Å—Ç—Ä–æ–∫</button>
            </div>
          </div>

          <div class="steps" id="steps"></div>

          <div class="sep"></div>

          <div class="row">
            <button class="btn primary" id="genBtn">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å HTML</button>
            <button class="btn ghost" id="copyBtn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn ghost" id="downloadBtn">–°–∫–∞—á–∞—Ç—å .html</button>
          </div>

          <p class="muted" style="margin-top:8px;">–ü–æ–¥—Å–∫–∞–∑–∫–∞: –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ —à–∞–≥–∏ –∫–Ω–æ–ø–∫–∞–º–∏ ‚Üë/‚Üì, —É–¥–∞–ª—è–π—Ç–µ –Ω–µ–Ω—É–∂–Ω—ã–µ –∏ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –ø—Ä–µ–≤—å—é –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.</p>
        </div>
      </section>

      <section class="card preview">
        <h2>–ü—Ä–µ–≤—å—é</h2>
        <div class="body">
          <div style="position: relative;">
            <iframe id="preview" title="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏"></iframe>
            <button class="btn ghost" id="fullscreenBtn" style="position: absolute; top: 8px; right: 8px; z-index: 10; backdrop-filter: blur(10px); background: rgba(255,255,255,0.9);" title="–ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω">üîç</button>
          </div>
          <div class="sep"></div>
          <label for="output">–ì–æ—Ç–æ–≤—ã–π HTML</label>
          <textarea id="output" readonly></textarea>
        </div>
      </section>
    </div>
  </div>

  <!-- –®–∞–±–ª–æ–Ω —Å—Ç–∏–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤—Å—Ç—Ä–∞–∏–≤–∞—Ç—å—Å—è –≤ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π HTML -->
  <template id="embedded-style">
    <style>
      :root {
        --page-bg: #ffffff;
        --page-fg: #11131a;
        --page-muted: #6b7280;
        --page-border: #e5e7eb;
      }
      .dark {
        --page-bg: #0b1020;
        --page-fg: #e6e8f2;
        --page-muted: #9aa3b2;
        --page-border: #1e243a;
      }
      html, body { height: 100%; }
      body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Noto Sans', 'Helvetica Neue', Arial; background: var(--page-bg); color: var(--page-fg); }
      .container { max-width: 900px; margin: 0 auto; padding: 24px; }
      h1 { margin: 0 0 16px; font-size: clamp(22px, 4vw, 32px); }
      p.lead { color: var(--page-muted); margin-top: 0; }
      ol, ul { padding-left: 20px; }
      li { margin: 8px 0; }
      pre { background: #0a0f1e; color: #e8eaf6; padding: 12px; border-radius: 8px; overflow:auto; }
      code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; }
      img { max-width: 100%; border-radius: 8px; }
      hr { border: none; border-top: 1px solid var(--page-border); margin: 16px 0; }
    </style>
  </template>

  <script>
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    // Theme
    const app = $('#app');
    const themeSel = $('#theme');
    themeSel.addEventListener('change', () => {
      app.setAttribute('data-theme', themeSel.value);
      updatePreview();
    });

    // Form elements
    const titleEl = $('#title');
    const introEl = $('#intro');
    const stepsEl = $('#steps');
    const listTypeEl = $('#listType');
    const outputEl = $('#output');
    const iframe = $('#preview');

    const genBtn = $('#genBtn');
    const copyBtn = $('#copyBtn');
    const downloadBtn = $('#downloadBtn');
    const addStepBtn = $('#addStep');
    const addFromLinesBtn = $('#addStepFromLines');
    const resetBtn = $('#resetBtn');
    const fullscreenBtn = $('#fullscreenBtn');
    const fullscreenModal = $('#fullscreenModal');
    const fullscreenIframe = $('#fullscreenIframe');
    const modalClose = $('#modalClose');

    function createStep(text='') {
      const idx = stepsEl.children.length + 1;
      const wrap = document.createElement('div');
      wrap.className = 'step';
      wrap.innerHTML = `
        <div class="step-head">
          <div class="step-index" aria-hidden="true"></div>
          <div class="step-controls">
            <button class="btn icon ghost" title="–í—ã—à–µ" aria-label="–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤—ã—à–µ">‚Üë</button>
            <button class="btn icon ghost" title="–ù–∏–∂–µ" aria-label="–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –Ω–∏–∂–µ">‚Üì</button>
            <button class="btn icon ghost" title="–£–¥–∞–ª–∏—Ç—å" aria-label="–£–¥–∞–ª–∏—Ç—å —à–∞–≥">‚úï</button>
          </div>
        </div>
        <textarea class="step-text" placeholder="–¢–µ–∫—Å—Ç —à–∞–≥–∞..."></textarea>
        <div class="muted">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–µ —à–∞–≥–∏. –ù—É–º–µ—Ä–∞—Ü–∏—è –≤ —Ç–µ–∫—Å—Ç–µ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</div>
      `;
      stepsEl.appendChild(wrap);
      $('.step-text', wrap).value = text;

      const [up, down, del] = $$('.btn.icon', wrap);
      up.addEventListener('click', () => moveStep(wrap, -1));
      down.addEventListener('click', () => moveStep(wrap, +1));
      del.addEventListener('click', () => { wrap.remove(); renumber(); updatePreview(); });
      $('.step-text', wrap).addEventListener('input', debounce(updatePreview, 200));
      renumber();
    }

    function setupDragAndDrop(stepEl) {
      let draggedElement = null;
      
      stepEl.addEventListener('dragstart', (e) => {
        draggedElement = stepEl;
        stepEl.classList.add('dragging');
        stepsEl.classList.add('drag-active');
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/html', stepEl.outerHTML);
      });
      
      stepEl.addEventListener('dragend', () => {
        stepEl.classList.remove('dragging');
        stepsEl.classList.remove('drag-active');
        $$('.step').forEach(el => el.classList.remove('drag-over'));
        draggedElement = null;
      });
      
      stepEl.addEventListener('dragover', (e) => {
        if (draggedElement && draggedElement !== stepEl) {
          e.preventDefault();
          e.dataTransfer.dropEffect = 'move';
        }
      });
      
      stepEl.addEventListener('dragenter', (e) => {
        if (draggedElement && draggedElement !== stepEl) {
          stepEl.classList.add('drag-over');
        }
      });
      
      stepEl.addEventListener('dragleave', (e) => {
        if (!stepEl.contains(e.relatedTarget)) {
          stepEl.classList.remove('drag-over');
        }
      });
      
      stepEl.addEventListener('drop', (e) => {
        e.preventDefault();
        stepEl.classList.remove('drag-over');
        
        if (draggedElement && draggedElement !== stepEl) {
          const rect = stepEl.getBoundingClientRect();
          const midY = rect.top + rect.height / 2;
          
          if (e.clientY < midY) {
            stepsEl.insertBefore(draggedElement, stepEl);
          } else {
            stepsEl.insertBefore(draggedElement, stepEl.nextSibling);
          }
          
          renumber();
          updatePreview();
        }
      });
    }

    function moveStep(stepEl, dir) {
      const sib = dir < 0 ? stepEl.previousElementSibling : stepEl.nextElementSibling;
      if (!sib) return;
      if (dir < 0) stepsEl.insertBefore(stepEl, sib); else stepsEl.insertBefore(sib, stepEl);
      renumber();
      updatePreview();
    }

    function renumber() { $$('.step', stepsEl).forEach((el, i) => $('.step-index', el).textContent = i + 1); }

    function sanitizeLine(s) {
      return s.replace(/^\s*[0-9]+[.)-]?\s+/, '').trim();
    }

    function getSteps() {
      return $$('.step-text', stepsEl)
        .map(t => t.value)
        .map(t => t.split(/\n+/).map(sanitizeLine).filter(Boolean))
        .filter(arr => arr.length > 0)
        .map(arr => arr.join('\n'));
    }

    function buildGeneratedHTML() {
      const title = titleEl.value.trim() || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
      const intro = introEl.value.trim();
      const steps = getSteps();
      const tag = listTypeEl.value === 'ul' ? 'ul' : 'ol';
      const theme = themeSel.value;

      const style = $('#embedded-style').innerHTML; // includes <style>...

      const listItems = steps
        .map(s => `<li>${escapeHtml(s).replaceAll('\n', '<br>')}</li>`)
        .join('\n        ');

      return `<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>${escapeHtml(title)}</title>
  ${style}
</head>
<body class="${theme === 'dark' ? 'dark' : ''}">
  <div class="container">
    <h1>${escapeHtml(title)}</h1>
    ${intro ? `<p class="lead">${escapeHtml(intro)}</p>` : ''}
    <${tag}>
      ${listItems}
    </${tag}>
  </div>
</body>
</html>`;
    }

    function escapeHtml(str) {
      return str.replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[s]));
    }

    function updatePreview() {
      const html = buildGeneratedHTML();
      outputEl.value = html;
      iframe.srcdoc = html;
    }

    function debounce(fn, ms=200) {
      let t; return (...args) => { clearTimeout(t); t = setTimeout(() => fn.apply(null, args), ms); };
    }

    // Actions
    genBtn.addEventListener('click', updatePreview);
    addStepBtn.addEventListener('click', () => { createStep(''); updatePreview(); });
    addFromLinesBtn.addEventListener('click', () => {
      const raw = prompt('–í—Å—Ç–∞–≤—å—Ç–µ —Å–ø–∏—Å–æ–∫ —à–∞–≥–æ–≤ (–∫–∞–∂–¥—ã–π —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏):');
      if (!raw) return;
      raw.split(/\n+/).map(s => s.trim()).filter(Boolean).forEach(line => createStep(line));
      updatePreview();
    });

    copyBtn.addEventListener('click', async () => {
      const html = outputEl.value || buildGeneratedHTML();
      try {
        if (navigator.clipboard?.writeText) {
          await navigator.clipboard.writeText(html);
        } else {
          outputEl.focus(); outputEl.select(); document.execCommand('copy');
        }
        toast('HTML —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
      } catch(e) { alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å: ' + e.message); }
    });

    downloadBtn.addEventListener('click', () => {
      const html = outputEl.value || buildGeneratedHTML();
      const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      const safeTitle = (titleEl.value.trim() || 'instruction').replace(/[^\w\-]+/g, '_');
      a.download = safeTitle + '.html';
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(() => URL.revokeObjectURL(a.href), 1000);
    });

    resetBtn.addEventListener('click', () => {
      if (!confirm('–û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É –∏ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ?')) return;
      localStorage.removeItem('html-generator-data');
      titleEl.value = ''; introEl.value=''; listTypeEl.value='ol'; themeSel.value='light'; app.setAttribute('data-theme','light');
      stepsEl.innerHTML='';
      createStep('–ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã');
      createStep('–°–ª–µ–¥—É–π—Ç–µ –ø–æ—à–∞–≥–æ–≤–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏');
      updatePreview();
      toast('–î–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã');
    });

    // Auto-save functionality
    function saveToStorage() {
      const data = {
        title: titleEl.value,
        intro: introEl.value,
        listType: listTypeEl.value,
        theme: themeSel.value,
        steps: $$('.step-text', stepsEl).map(el => el.value)
      };
      localStorage.setItem('html-generator-data', JSON.stringify(data));
    }

    function loadFromStorage() {
      try {
        const saved = localStorage.getItem('html-generator-data');
        if (!saved) return false;
        
        const data = JSON.parse(saved);
        titleEl.value = data.title || '';
        introEl.value = data.intro || '';
        listTypeEl.value = data.listType || 'ol';
        themeSel.value = data.theme || 'light';
        app.setAttribute('data-theme', data.theme || 'light');
        
        stepsEl.innerHTML = '';
        if (data.steps && data.steps.length > 0) {
          data.steps.forEach(step => createStep(step));
        } else {
          createStep('–û—Ç–∫—Ä–æ–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã');
          createStep('–î–æ–±–∞–≤—å—Ç–µ —à–∞–≥–∏, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ');
        }
        return true;
      } catch (e) {
        console.warn('Failed to load from storage:', e);
        return false;
      }
    }

    // Live update with auto-save
    const saveDebounced = debounce(saveToStorage, 1000);
    [titleEl, introEl, listTypeEl].forEach(el => {
      el.addEventListener('input', debounce(() => {
        updatePreview();
        saveDebounced();
      }, 200));
    });
    
    themeSel.addEventListener('change', saveDebounced);

    // Save when steps change
    const originalUpdatePreview = updatePreview;
    updatePreview = function() {
      originalUpdatePreview();
      saveDebounced();
    };

    // Fullscreen preview functionality
    fullscreenBtn.addEventListener('click', () => {
      const html = buildGeneratedHTML();
      fullscreenIframe.srcdoc = html;
      fullscreenModal.classList.add('show');
      document.body.style.overflow = 'hidden';
    });

    function closeModal() {
      fullscreenModal.classList.remove('show');
      document.body.style.overflow = '';
    }

    modalClose.addEventListener('click', closeModal);
    fullscreenModal.addEventListener('click', (e) => {
      if (e.target === fullscreenModal) closeModal();
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && fullscreenModal.classList.contains('show')) {
        closeModal();
      }
    });

    // Toast helper
    function toast(msg) {
      const t = document.createElement('div');
      t.textContent = msg; t.style.cssText = 'position:fixed;left:50%;top:16px;transform:translateX(-50%);background:#111c;color:#fff;padding:8px 12px;border-radius:8px;z-index:9999;opacity:0;transition:.2s;';
      document.body.appendChild(t); requestAnimationFrame(() => t.style.opacity = '1');
      setTimeout(() => { t.style.opacity = '0'; setTimeout(() => t.remove(), 200); }, 1400);
    }

    // Bootstrap initial UI
    if (!loadFromStorage()) {
      createStep('–û—Ç–∫—Ä–æ–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã');
      createStep('–î–æ–±–∞–≤—å—Ç–µ —à–∞–≥–∏, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ');
    }
    updatePreview();
  </script>
</body>
</html>
